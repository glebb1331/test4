# Практическая работа №4: Анализ кода на Python и Go

## 1. Титульный лист

Практическая работа №4 по дисциплине "Анализ и качество программного обеспечения".

Тема: "Статический и динамический анализ кода на языках Python и Go".

Студент: ФИО, группа.

Преподаватель: ФИО.

Город, год.

---

## 2. Описание проектов

### 2.1. Python: конвертер скорости

Проект реализует конвертацию скорости из километров в час в метры в секунду.

Функция:

- `kmh_to_ms(kmh: float) -> float` — принимает значение скорости в км/ч и возвращает эквивалент в м/с по формуле `v_ms = v_kmh / 3.6`.

Файлы:

- `speed_converter.py` — корректная версия.
- `speed_converter_static.py` — версия с преднамеренными ошибками для статического анализа.
- `speed_converter_runtime.py` — версия с преднамеренными ошибками времени выполнения для динамического анализа.

### 2.2. Go: калькулятор

Проект реализует простой калькулятор с операциями сложения, вычитания, умножения и деления.

Функции:

- `Add(a, b float64) float64`
- `Sub(a, b float64) float64`
- `Mul(a, b float64) float64`
- `Div(a, b float64) (float64, error)` в корректной версии.

Файлы:

- `calculator.go` — корректная версия.
- `calculator_static.go` — версия с преднамеренными ошибками для статического анализа.
- `calculator_runtime.go` — версия с преднамеренными ошибками времени выполнения для динамического анализа.

---

## 3. Статический анализ

### 3.1. Инструменты для Python

Используемые инструменты:

- `pylint`
- `bandit`
- `SonarQube` / `SonarCloud`

Запуск (пример):

- `pylint speed_converter.py`
- `pylint speed_converter_static.py`
- `bandit -r .`

#### 3.1.1. Результаты до внесения ошибок (Python)

| № | Инструмент | Файл                | Тип проблемы                  | Описание                                       |
|---|------------|---------------------|-------------------------------|------------------------------------------------|
| 1 | pylint     | speed_converter.py  | Стиль/PEP8                   | Незначительные замечания или отсутствуют       |
| 2 | bandit     | speed_converter.py  | Безопасность                 | Уязвимости не обнаружены                       |
| 3 | SonarQube  | speed_converter.py  | Потенциальные дефекты        | Существенных дефектов не обнаружено           |

#### 3.1.2. Результаты после внесения ошибок (Python)

Файл `speed_converter_static.py` содержит следующие преднамеренные проблемы:

1. Нарушение PEP 8 (имена функций и переменных, отступы).
2. Логическая ошибка в формуле конвертации (умножение вместо деления на 3.6).
3. Отсутствие обработки исключений при преобразовании ввода в число.
4. Неиспользуемая переменная.
5. Возможное деление на ноль.

Ожидаемые результаты:

| № | Инструмент | Файл                     | Тип проблемы           | Краткое описание                                   |
|---|------------|--------------------------|------------------------|----------------------------------------------------|
| 1 | pylint     | speed_converter_static.py| Стиль/PEP8            | Нарушения именования, отступов, форматирования    |
| 2 | pylint     | speed_converter_static.py| Неиспользуемый код    | Неиспользуемая переменная                         |
| 3 | pylint     | speed_converter_static.py| Потенциальная ошибка  | Деление на выражение, дающее ноль                 |
| 4 | SonarQube  | speed_converter_static.py| Логический дефект     | Неверная формула пересчета                        |
| 5 | bandit     | speed_converter_static.py| Потенциальный дефект  | Подозрительное деление                            |

### 3.2. Инструменты для Go

Используемые инструменты:

- `go vet`
- `golangci-lint`
- `SonarQube` / `SonarCloud`

Запуск (пример):

- `go vet ./...`
- `golangci-lint run`

#### 3.2.1. Результаты до внесения ошибок (Go)

| № | Инструмент    | Файл           | Тип проблемы           | Описание                                       |
|---|---------------|----------------|------------------------|------------------------------------------------|
| 1 | go vet        | calculator.go  | Потенциальные дефекты  | Существенных замечаний не обнаружено           |
| 2 | golangci-lint | calculator.go  | Стиль и ошибки         | Замечания отсутствуют или минимальны           |
| 3 | SonarQube     | calculator.go  | Качество кода          | Код считается корректным                       |

#### 3.2.2. Результаты после внесения ошибок (Go)

Файл `calculator_static.go` содержит следующие преднамеренные проблемы:

1. Нарушение стиля (экспортируемая функция без документации, неиспользуемая).
2. Логическая ошибка в функции умножения (операция сложения вместо умножения).
3. Паника при делении на ноль без проверки в `Div`.
4. Утечка памяти через глобальную структуру и создание большого слайса в цикле.
5. Неиспользуемый импорт.

Ожидаемые результаты:

| № | Инструмент    | Файл                | Тип проблемы            | Краткое описание                                   |
|---|---------------|---------------------|-------------------------|----------------------------------------------------|
| 1 | golangci-lint | calculator_static.go| Стиль и формат          | Нарушение соглашений об экспортируемых функциях   |
| 2 | golangci-lint | calculator_static.go| Неиспользуемый импорт   | Лишний импорт пакета `time`                       |
| 3 | go vet        | calculator_static.go| Потенциальные дефекты   | Подозрительная реализация арифметических функций  |
| 4 | SonarQube     | calculator_static.go| Логический дефект       | Неверная реализация умножения                     |
| 5 | SonarQube     | calculator_static.go| Риск утечки памяти      | Создание большого слайса в цикле                  |

---

## 4. Динамический анализ

### 4.1. Динамический анализ Python-проекта

Используемые инструменты:

- `cProfile`
- `memory_profiler`

Запуск (пример):

- `python -m cProfile -o profile_correct.prof speed_converter.py`
- `python -m cProfile -o profile_runtime.prof speed_converter_runtime.py`
- `python -m memory_profiler speed_converter.py`
- `python -m memory_profiler speed_converter_runtime.py`

Файл `speed_converter_runtime.py` содержит следующие преднамеренные ошибки времени выполнения:

1. Бесконечный цикл при некорректном вводе (при многократном неверном вводе программа не завершается по инициативе пользователя).
2. Утечка памяти через глобальную структуру `DATA_LEAK`.
3. Ошибка ввода-вывода при чтении несуществующего файла.

Сравнение результатов до/после:

| Сценарий                  | Время выполнения (относительно) | Потребление памяти (относительно) | Особенности поведения                     |
|---------------------------|----------------------------------|------------------------------------|-------------------------------------------|
| Корректная версия         | Низкое                           | Низкое                             | Быстрый ввод-вывод, без исключений        |
| Версия с ошибками runtime | Выше                             | Значительно выше                   | Увеличение памяти, возможные исключения   |

### 4.2. Динамический анализ Go-проекта

Используемые инструменты:

- `pprof` (CPU и память)
- `go test -race` или `go run -race`

Запуск (пример):

- `go run -race calculator_runtime.go`
- `go test -race ./...`
- `go test -run ^$ -bench . -benchmem -cpuprofile cpu.out -memprofile mem.out`
- `go tool pprof cpu.out`
- `go tool pprof mem.out`

Файл `calculator_runtime.go` содержит следующие преднамеренные ошибки времени выполнения:

1. Гонка данных при параллельных вызовах `Add` и `Sub`, использующих общую глобальную переменную.
2. Утечка памяти через бесконечно работающую goroutine.
3. Паника при передаче `nil` в функцию, разыменовывающую указатель.

Ожидаемые результаты:

| № | Инструмент | Файл                 | Тип проблемы          | Краткое описание                                 |
|---|------------|----------------------|-----------------------|--------------------------------------------------|
| 1 | -race      | calculator_runtime.go| Гонка данных         | Предупреждения о конкурентном доступе к памяти  |
| 2 | pprof      | calculator_runtime.go| Нагрузочные участки  | Повышенная нагрузка и использование памяти       |
| 3 | runtime    | calculator_runtime.go| Паника               | Сообщение о разыменовании нулевого указателя     |

---

## 5. Сравнительный анализ

### 5.1. Ошибки, найденные только статическим анализом

1. Нарушения стиля и PEP 8 (Python), соглашений об именовании и экспортируемых сущностях (Go).
2. Неиспользуемые переменные и импорты.
3. Потенциальные деления на ноль, которые могут не проявиться сразу в реальном запуске.
4. Некоторые логические несоответствия (например, подозрительная формула конвертации или реализация умножения через сложение).

### 5.2. Ошибки, найденные только динамическим анализом

1. Гонки данных в параллельных вызовах функций Go-калькулятора.
2. Реальные утечки памяти, связанные с бесконечно растущими структурами или бесконечно работающими goroutine.
3. Исключения и паники, возникающие при конкретных сценариях ввода (например, разыменование `nil` или ошибки ввода-вывода).

### 5.3. Ложные срабатывания

1. Статические анализаторы могут помечать некоторые участки кода как потенциально опасные, даже если в конкретной конфигурации они не приводят к ошибкам.
2. Динамический анализ может не обнаружить все дефекты, если тестовое покрытие недостаточно и не все пути выполнения были пройдены.

---

## 6. Выводы

1. Статический анализ кода на Python и Go позволяет рано обнаруживать широкий спектр проблем: от стиля и соглашений до потенциальных логических ошибок и источников уязвимостей.
2. Динамический анализ дополняет статический, выявляя ошибки времени выполнения, зависящие от конкретных сценариев использования: гонки данных, утечки памяти, падения при работе с вводом-выводом.
3. На практике наилучший результат достигается при совместном использовании нескольких статических анализаторов и инструментов динамического профилирования и тестирования.
4. Для небольших учебных проектов достаточно использовать базовые средства (`pylint`, `bandit`, `go vet`, `golangci-lint`, простые профайлеры). Для промышленных систем рекомендуется внедрение SonarQube/SonarCloud и автоматического запуска анализаторов в CI/CD.

---

## 7. Приложения

1. Исходный код проектов:
   - `speed_converter.py`
   - `speed_converter_static.py`
   - `speed_converter_runtime.py`
   - `calculator.go`
   - `calculator_static.go`
   - `calculator_runtime.go`
2. Скриншоты отчётов статического анализа (Pylint, Bandit, golangci-lint, go vet, SonarQube / SonarCloud).
3. Скриншоты и текстовые логи динамического анализа (cProfile, memory_profiler, pprof, go test -race).
4. Логи запуска команд анализаторов и профилировщиков.

